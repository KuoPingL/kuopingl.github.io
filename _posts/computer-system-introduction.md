---
layout: post
title:  "Operation System Concepts - Introduction"
date:   2022-08-08 16:15:07 +0800
categories: [operation system concepts, beginner]
---

### Background
This is a side notes or summary to the book **Operating System Concepts**. <br>Feel free to read along and use this as a brief recap.

### About Computer System
A computer system is composed of 4 components [[1][1]]:
- Users
- Application
- Operation System
- Computer Hardware

>Just to give you a sense on what roles does each components play, here's an simple interaction between computer and user :

- Users can interact with the application through various inputs (<u>hardware</u>), which will pass the signal to the <u>OS</u> and trigger actions in the <u>application</u>.

- The <u>application</u> will decide what to do from the interaction, and pass the result or data back to the <u>OS</u>, which will display the output via the screen (<u>hardware</u>).

Next, we will take a look at what is an OS.

### OS
>**An Operation System is the program that runs at all time in computer** aka **kernel** [[1][1]]
><br>But that's not all there is to it ...

In mobile OS, such as iOS and Android, an OS is considered the combination of **kernel** and **middleware**.

>A middleware is **a set of software frameworks that provide additional services to application developers** [[1][1]]
><br><br>
>an example would be the **Application Framework** (Java API Framework) in Android

<figure>
<center>
<a href = "https://developer.android.com/guide/platform">
<img src = "/images/common/android-platform-architecture.png" style="width:80%" title="Android Platform architecture"/>
</a>
</center>
<br>
<figcaption><b>Figure 1 :</b> Android Platform Architecture</figcaption>
</figure>

### Hardware (I/O Devices)
<figure>
<center>
<img src = "/images/posts/jekyll/os/device-controller-shared-memory-cpu.png" style = "width:90%"/>
</center>
<figcaption><b><br>Figure 2: By connecting the device controllers (ie keyboard) through bus, they can access the shared memory (RAM) with CPU(s).</b></figcaption>
</figure>
<br>

I/O devices can be roughly divided into 3 categories [ [6][Linux_Device_Driver] ]:
- **Block** devices
>It is used to **store information** in **fixed-size** blocks
>
> ie Hard disks, CD-ROMs, and USB sticks

- **Character** devices
> It is used to **deliver** or **accepts** a **stream of characters**, without regard to any
block structure.
>
>ie Printers, network interfaces and mouse

- **Network Interface** (won't cover)

Devices are connected to the CPU and memory through **system bus**.

>A **bus** is a common electrical path (wire) between multiple components.
><br><br>It can either be internal to CPU (transport data to / from ALU) or external to CPU (**System Bus**, to connect CPU to memory or I/O devices) ( [ref](https://www.slideserve.com/santa/computer-buses) ) .


<figure>
<center>
<img src = "/images/posts/jekyll/os/system-bus.jpg" style = "width:90%"/>
</center>
</figure>

<br>

A **System Bus** is separated into 3 functional groups ( [ref](https://ppt-online.org/246314) ):
- **Data** bus
>It is **Bidirectional**, its width can be 32, 64, 128 or even more separated lines.
<br> Since each line can only carry **1 bit** at a time, therefore, the number of lines is the number of bits that it can transfer.
- **Address** bus
>It is a **computer bus**, a series of lines connecting two or more devices, that is used to specify a **physical address**.
<br><br>A **physical address** (aka real address / binary address) is the actual address of the data inside the memory.
><br><br>In contract with **physical address**, a **logical address** is a **virtual** address that is generated by the CPU while a program is running ( [ref](https://workat.tech/core-cs/tutorial/logical-and-physical-address-os-8abv46w3k0bu) ).

<details>
<summary><b>Logical Address</b></summary>

Other than **physical address**, there is also **logical** address.

>A **Logical address** is a **virtual address** generated by the CPU while a program is running ( [ref](https://workat.tech/core-cs/tutorial/logical-and-physical-address-os-8abv46w3k0bu) ).

The user never directly deals with the physical address but can access it by its corresponding **logical address**.
</details>
<br>

- **Control** bus


#### Device Components
Every devices consist of two components :
- **mechanical** component : the device itself.
- **electronical** component : **device controller**

>
>**Device Controller** is responsible for the following tasks [ [2][Operating_Systems_kyliu] ]:
> 1. Convert the serial bit stream into a block of bytes
> 2. Perform any error correction necessary
> 3. Copy data to main memory

For instance, a **char driver** is responsible for implementing the behaviour of a **character (char) device**, to open, close, read, and write system calls.

**Note :** There are devices that use memory address instead of a physical device for the mechanical component. ie *Binder*

##### Device Controller
>A **device controller** is a hardware unit attached to the I/O bus of the computer and works like an interface between a **device** and a **device driver** [ [3][Difference_between_device_driver_and_device_controller] ]. <br><br>
> It is in the form of **chip** or **circuit board** that controls functioning of the I/O device [ [4][selfgrowth_device_controller_and_controller_register] ], such as <b>*serial port controller*</b> and <b>*disk driver*</b>, respectively.
>
>Some devices even have their own **built-in controllers**, such as <b>*disk driver*</b>.

Each device controller, I/O controller, is designed to handle a particular kind of device.

Within every controller, there are a few **registers** that are used for communicating with the CPU [ [2][Operating_Systems_kyliu] ].

##### Device Control Register
>A **register** is simply a device that can store bits.
><br> Most of the time, a device has more than 1 register and they are accessed at consecutive **addresses**.

There are 3 primary types of **registers** :
1. **Control / Command** register
2. **Status** register
3. **Data** register

Registers can either be combined or separated.

By **writing into these registers**, kernel can command the device to do various actions, such as [ [5][idc-memory-mapped-port-mapped] ]:
-  deliver data, read data, turn on and off

Of course, OS can also **read from the register** (**status** register) to know what status the device is at.

That being said, <u>how will OS read from / write to these registers ?</u>
>This is where **device driver** comes in.

#### Device Driver
In order for kernel to interact with devices, a **device driver** is needed for each hardware components.

>"A **driver** in software provides a programming interface to control and manage specific lower level interfaces that are often linked to a specific type of hardware, or other low-level service." [[2][2]]
><br><br>
>In another word : <br>**A driver is a program that is responsible for interacting with hardware or services.** (ie Binder in Android and touch pad in touchable display)
><br><br>
> Also, **drivers** are <b><u>*hardware dependent*</u></b> and <b><u>*operating-system-specific*</u></b>.

<u>All device control operations are performed by **device driver**.</u>

Through **device driver**, OS can now interact with the **device controller**, which is the device itself.

> Now comes the question :
> <br>**How does a driver access the device ?**

#### Accessing the device
The addresses of the registers are either in the
- **memory address space** or in the
- **I/O address space**

>**Address Space**
><br>the amount of memory allocated for all possible addresses for a computational entity ( [source](https://www.techtarget.com/searchstorage/definition/address-space) )

>**Memory Address Space**
><br>

>**I/O Address Space**
><br>


#### I / O Operation



When hardware is being used, I/O operation will be performed.

To start an I/O operation [ [1] ]:
- the **device driver** loads the appropriate <b>*registers*</b> in the **device controller**
>**Hardware registers** are circuits typically composed of <b>*flip flops*</b>.
>Usually with many characteristics similar to memory, such as [[3]]:
>- The ability to read or write multiple bits at a time
>-Using an address to select a particular register in a manner similar to a memory address
-By examining the registers, **device controller** will determine the action to take (ie read from keyboard)
>Each device controller maintains a set of device registers [[5]]:
> - command register (write only)
> - status registers (read-only)
> - data registers (read/write).
- The **controller** will start to transfer data to the <b>*local buffer*</b>
>Each **device controller** has a local buffer [[6]]
- Once the transfer is completed, **controller** will let **driver** know operation has finished.
>This is done through **interrupt**
><br><br>Interrupts are used for many other purposes
as well and are a key part of how operating systems and hardware interact.
- Then, **device driver** will give control to other parts of the **OS** ( ie return data or pointer for read operation )














[1]:https://www.os-book.com/OS10/ "Operating System Concepts, 10th ed."

[2]: https://en.wikipedia.org/wiki/Driver_(software) "wiki: Driver (software)"

[2a]: https://www.sharecourse.net/sharecourse/upload/person/4562/files/week11.pdf "靜宜大學資訊傳播工程學系 w11 lecture note"

[3]: https://en.wikipedia.org/wiki/Hardware_register "wiki: Hardware register"

[javatpoint-device-driver-vs-device-controller-in-operating-system]: https://www.javatpoint.com/device-driver-vs-device-controller-in-operating-system "Difference between Device Driver and Device Controller in Operating System"

[5]:https://student.cs.uwaterloo.ca/~cs350/F06/slides/cs350_G.pdf "cs350 (Fall 2006) - Slide G : Devices and Device Controllers"

[6]: https://www.youtube.com/watch?v=OJy9C5Gn4Sc "Principles of Operating System - Lecture 2 by Barbara Hecker"

[selfgrowth_device_controller_and_controller_register]: https://selfgrowth.com/articles/device-controller-and-controller-register "Device Controller and Controller Register By Imran Zafar"

[Operating_Systems_kyliu]: https://www.sharecourse.net/sharecourse/upload/person/4562/files/week11.pdf "靜宜大學資訊傳播工程學系 w11 lecture note"

[Difference_between_device_driver_and_device_controller]: http://www.differencebetween.net/technology/difference-between-device-driver-and-device-controller/ "Difference between device driver and device controller"

[idc-memory-mapped-port-mapped]:https://www.idc-online.com/technical_references/pdfs/information_technology/Device_Controllers_Memory_Mapped_and_Port_Mapped.pdf "Device_Controllers_Memory_Mapped_and_Port_Mapped"

[Linux_Device_Driver]:https://lwn.net/Kernel/LDD3/ "Linux Device Driver, 3rd Corbet J. et al"

[simple_device_driver_source]:https://github.com/apriorit/SimpleLinuxDriver/blob/master/device_file.c "Simple Linux Driver"

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
